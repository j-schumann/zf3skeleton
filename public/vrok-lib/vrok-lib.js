
(function($){window.Vrok=window.Vrok||{};Vrok.Tools=Vrok.Tools||{};Vrok.Tools.json=function(url,container,options){var $container=null;var defaults={callback:null,jsonp:false,scrollTo:false,showOverlay:true,data:{}};$.extend(defaults,options);if(typeof(container)==='string'){$container=$('#'+container);}else{$container=$(container);}
if(defaults.showOverlay){$container.loading(true);}
var request={dataType:"json",data:defaults.data,url:url,success:function(data){Vrok.Tools.processResponse(data,$container,defaults);if(typeof(defaults.callback)==='function'){defaults.callback($container);}},error:function(data){console.error('Vrok.Tools.json: Request to "'+url+'" failed!');console.debug(data);Vrok.Tools.processResponse(data.responseJSON,$container,defaults);}};if(defaults.jsonp){request.dataType='jsonp';request.jsonp='callback';}
$.ajax(request);};Vrok.Tools.submit=function(element,senderName,senderValue,container,options){var form=null;var defaults={callback:null,jsonp:false,scrollTo:true,showOverlay:true};$.extend(defaults,options);if(element.form){form=$(element.form);}else if(element.tagName&&element.tagName.toUpperCase()==='FORM'){form=$(element);}else if(typeof(element)==='string'){var result=$('#'+element);if(result.length){form=$(result[0]);}}
if(!form){console.log('vrok.tools.submit: Could not determine form to submit!');return false;}
if(senderName){var sender=$('<input type="hidden" value="'+senderValue
+'" name="'+senderName+'" />');form.append(sender);}
var ajaxRequest=$('<input type="hidden" value="1" name="ajaxRequest" />');form.append(ajaxRequest);var data=form.serialize();var $container=container?$('#'+container):$(form.context.parentNode);if(defaults.showOverlay){$container.loading();}
var request={type:"POST",dataType:"json",data:data,url:form.context.action,success:function(data){Vrok.Tools.processResponse(data,$container,defaults);if(typeof(defaults.callback)==='function'){defaults.callback($container);}},error:function(data){console.error('Vrok.Tools.submit: Request to "'
+form.context.action+'" failed!');console.debug(data);Vrok.Tools.processResponse(data.responseJSON,$container,defaults);}};$.ajax(request);return false;};Vrok.Tools.processResponse=function(response,container,options){if(response.html&&typeof(response.html)==='string'){if(response.container){container=$('#'+response.container);}
if(!container.html){console.error('Vrok.Tools.processResponse: Invalid container!');console.debug(container);return false;}
container.html($.parseHTML(response.html));if(options.showOverlay){container.loading(false);}
container.trigger('processed');if(options.scrollTo){$('html,body').animate({scrollTop:Math.max(container.offset().top-50,0)});}}
if(response.script){eval(response.script);}};$.fn.loading=function(state,addClass){var $this=$(this);state=state===undefined?true:!!state;$this.each(function(i,element){var $element=$(element);if(state&&$element.find(".js-loading-overlay").length===0){var $overlay=$("<div/>").addClass("js-loading-overlay");if(addClass!==undefined){$overlay.addClass(addClass);}
$element.append($overlay).addClass("js-loading");$overlay.css('top',$element.position().top+'px');$overlay.css('left',$element.position().left+'px');$overlay.css('width',$element.width()+'px');$overlay.css('height',$element.height()+'px');$overlay.stop().hide().fadeIn(400);}else if(!state){$element.removeClass("js-loading").find(".js-loading-overlay").remove();$this.find("input,button,.btn").removeClass("disabled").prop("disabled",false);}});return this;};$(document).ready(function(){$("body").on('keypress','.ajax-form',function(e){if(e.which===13){$(this).data('enter-pressed',e.target.name);}});$("body").on('keyup','.ajax-form',function(e){$(this).data('enter-pressed',"");});$("body").on('click','.ajax-form input[type="submit"]',function(e){var enterPressed=$(this.form).data('enter-pressed');if(enterPressed&&enterPressed!==this.name){e.preventDefault();return false;}
return Vrok.Tools.submit(this,this.name,this.value);});});}(jQuery));